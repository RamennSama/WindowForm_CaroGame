using System;
using System.Drawing;
using System.Windows.Forms;

namespace WindowFormLastVersion
{
    public partial class DifficultySelectForm : Form
    {
        public CaroGameForm.GameDifficulty SelectedDifficulty { get; private set; }
        public int MaxGames { get; private set; } = 5;

        private NumericUpDown numMaxGames;
        private Button btnOK;
        private Button btnCancel;
        private Button selectedButton = null;
        private bool isComputerMode;

        public DifficultySelectForm(bool computerMode = true)
        {
            isComputerMode = computerMode;
            InitializeComponent();
            SetupForm();
        }

        private void InitializeComponent()
        {
            if (isComputerMode)
            {
                Text = "Select Difficulty and Game Settings";
                ClientSize = new Size(440, 350);
            }
            else
            {
                Text = "Enter Player Names and Game Settings";
                ClientSize = new Size(440, 280);
            }

            StartPosition = FormStartPosition.CenterParent;
            FormBorderStyle = FormBorderStyle.FixedDialog;
            MaximizeBox = false;
            MinimizeBox = false;
            BackColor = Color.White;
        }

        private void SetupForm()
        {
            if (isComputerMode)
            {
                SetupComputerModeForm();
            }
            else
            {
                SetupPlayerModeForm();
            }
        }

        private void SetupComputerModeForm()
        {
            // Tiêu ??
            var lblTitle = new Label
            {
                Text = "Select Difficulty",
                Font = new Font("Times New Roman", 20, FontStyle.Bold),
                Location = new Point(0, 15),
                Size = new Size(440, 40),
                TextAlign = ContentAlignment.MiddleCenter,
                BackColor = Color.White,
                ForeColor = Color.Black
            };

            // Nút ch?n ?? khó Easy
            var easyButton = new Button
            {
                Text = "Easy",
                Font = new Font("Times New Roman", 14),
                Location = new Point(120, 70),
                Size = new Size(200, 35),
                BackColor = SystemColors.ButtonFace,
                ForeColor = Color.Black,
                FlatStyle = FlatStyle.Flat,
                UseVisualStyleBackColor = false,
                Tag = CaroGameForm.GameDifficulty.Easy
            };
            easyButton.FlatAppearance.BorderSize = 1;
            easyButton.FlatAppearance.BorderColor = Color.Gray;
            easyButton.Click += DifficultyButton_Click;

            // Nút ch?n ?? khó Medium
            var mediumButton = new Button
            {
                Text = "Medium",
                Font = new Font("Times New Roman", 14),
                Location = new Point(120, 115),
                Size = new Size(200, 35),
                BackColor = SystemColors.ButtonFace,
                ForeColor = Color.Black,
                FlatStyle = FlatStyle.Flat,
                UseVisualStyleBackColor = false,
                Tag = CaroGameForm.GameDifficulty.Medium
            };
            mediumButton.FlatAppearance.BorderSize = 1;
            mediumButton.FlatAppearance.BorderColor = Color.Gray;
            mediumButton.Click += DifficultyButton_Click;

            // Nút ch?n ?? khó Hard
            var hardButton = new Button
            {
                Text = "Hard",
                Font = new Font("Times New Roman", 14),
                Location = new Point(120, 160),
                Size = new Size(200, 35),
                BackColor = SystemColors.ButtonFace,
                ForeColor = Color.Black,
                FlatStyle = FlatStyle.Flat,
                UseVisualStyleBackColor = false,
                Tag = CaroGameForm.GameDifficulty.Hard
            };
            hardButton.FlatAppearance.BorderSize = 1;
            hardButton.FlatAppearance.BorderColor = Color.Gray;
            hardButton.Click += DifficultyButton_Click;

            // Label cho s? ván ch?i
            var lblMaxGames = new Label
            {
                Text = "Number of",
                Font = new Font("Times New Roman", 14, FontStyle.Regular),
                Location = new Point(40, 210),
                Size = new Size(120, 30),
                TextAlign = ContentAlignment.MiddleLeft,
                BackColor = Color.White
            };

            numMaxGames = new NumericUpDown
            {
                Font = new Font("Times New Roman", 14),
                Location = new Point(170, 210),
                Size = new Size(220, 30),
                Minimum = 1,
                Maximum = 10,
                Value = 5
            };

            // Nút OK
            btnOK = new Button
            {
                Text = "OK",
                Font = new Font("Times New Roman", 14),
                Size = new Size(120, 40),
                Location = new Point(90, 260),
                BackColor = Color.White,
                ForeColor = Color.Black,
                FlatStyle = FlatStyle.Flat,
                DialogResult = DialogResult.OK
            };
            btnOK.FlatAppearance.BorderSize = 2;
            btnOK.FlatAppearance.BorderColor = Color.SteelBlue;
            btnOK.Click += BtnOK_Click;

            // Nút Cancel
            btnCancel = new Button
            {
                Text = "Cancel",
                Font = new Font("Times New Roman", 14),
                Size = new Size(120, 40),
                Location = new Point(230, 260),
                BackColor = Color.White,
                ForeColor = Color.Black,
                FlatStyle = FlatStyle.Flat,
                DialogResult = DialogResult.Cancel
            };
            btnCancel.FlatAppearance.BorderSize = 2;
            btnCancel.FlatAppearance.BorderColor = Color.SteelBlue;

            // Thêm các control vào form
            Controls.Add(lblTitle);
            Controls.Add(easyButton);
            Controls.Add(mediumButton);
            Controls.Add(hardButton);
            Controls.Add(lblMaxGames);
            Controls.Add(numMaxGames);
            Controls.Add(btnOK);
            Controls.Add(btnCancel);

            this.AcceptButton = btnOK;
            this.CancelButton = btnCancel;
        }

        private void SetupPlayerModeForm()
        {
            // Tiêu ??
            var lblTitle = new Label
            {
                Text = "Player Settings",
                Font = new Font("Times New Roman", 20, FontStyle.Bold),
                Location = new Point(0, 15),
                Size = new Size(440, 40),
                TextAlign = ContentAlignment.MiddleCenter,
                BackColor = Color.White,
                ForeColor = Color.Black
            };

            // Label và TextBox cho Player X
            var lblPlayerX = new Label
            {
                Text = "Player X",
                Font = new Font("Times New Roman", 14, FontStyle.Regular),
                Location = new Point(40, 70),
                Size = new Size(120, 30),
                TextAlign = ContentAlignment.MiddleLeft,
                BackColor = Color.White
            };

            var txtPlayerX = new TextBox
            {
                Font = new Font("Times New Roman", 14),
                Location = new Point(170, 70),
                Size = new Size(220, 30),
                Text = "Player X"
            };

            // Label và TextBox cho Player O
            var lblPlayerO = new Label
            {
                Text = "Player O",
                Font = new Font("Times New Roman", 14, FontStyle.Regular),
                Location = new Point(40, 110),
                Size = new Size(120, 30),
                TextAlign = ContentAlignment.MiddleLeft,
                BackColor = Color.White
            };

            var txtPlayerO = new TextBox
            {
                Font = new Font("Times New Roman", 14),
                Location = new Point(170, 110),
                Size = new Size(220, 30),
                Text = "Player O"
            };

            // Label cho s? ván ch?i
            var lblMaxGames = new Label
            {
                Text = "Number of",
                Font = new Font("Times New Roman", 14, FontStyle.Regular),
                Location = new Point(40, 150),
                Size = new Size(120, 30),
                TextAlign = ContentAlignment.MiddleLeft,
                BackColor = Color.White
            };

            numMaxGames = new NumericUpDown
            {
                Font = new Font("Times New Roman", 14),
                Location = new Point(170, 150),
                Size = new Size(220, 30),
                Minimum = 1,
                Maximum = 10,
                Value = 5
            };

            // Nút OK
            btnOK = new Button
            {
                Text = "OK",
                Font = new Font("Times New Roman", 14),
                Size = new Size(120, 40),
                Location = new Point(90, 200),
                BackColor = Color.White,
                ForeColor = Color.Black,
                FlatStyle = FlatStyle.Flat,
                DialogResult = DialogResult.OK
            };
            btnOK.FlatAppearance.BorderSize = 2;
            btnOK.FlatAppearance.BorderColor = Color.SteelBlue;
            btnOK.Click += BtnOK_Click;

            // Nút Cancel
            btnCancel = new Button
            {
                Text = "Cancel",
                Font = new Font("Times New Roman", 14),
                Size = new Size(120, 40),
                Location = new Point(230, 200),
                BackColor = Color.White,
                ForeColor = Color.Black,
                FlatStyle = FlatStyle.Flat,
                DialogResult = DialogResult.Cancel
            };
            btnCancel.FlatAppearance.BorderSize = 2;
            btnCancel.FlatAppearance.BorderColor = Color.SteelBlue;

            // Thêm các control vào form
            Controls.Add(lblTitle);
            Controls.Add(lblPlayerX);
            Controls.Add(txtPlayerX);
            Controls.Add(lblPlayerO);
            Controls.Add(txtPlayerO);
            Controls.Add(lblMaxGames);
            Controls.Add(numMaxGames);
            Controls.Add(btnOK);
            Controls.Add(btnCancel);

            this.AcceptButton = btnOK;
            this.CancelButton = btnCancel;
        }

        private void DifficultyButton_Click(object sender, EventArgs e)
        {
            var clickedButton = sender as Button;

            // Reset tất cả nút về trạng thái mặc định
            foreach (Control control in Controls)
            {
                if (control is Button button && button.Tag != null)
                {
                    button.BackColor = SystemColors.ButtonFace;
                    button.ForeColor = Color.Black;
                    button.UseVisualStyleBackColor = true;
                }
            }

            // Đổi màu nút được chọn - giữ màu rõ ràng
            clickedButton.BackColor = Color.SteelBlue;
            clickedButton.ForeColor = Color.White;
            clickedButton.UseVisualStyleBackColor = false;
            clickedButton.FlatStyle = FlatStyle.Flat;
            clickedButton.FlatAppearance.BorderSize = 2;
            clickedButton.FlatAppearance.BorderColor = Color.DarkBlue;

            selectedButton = clickedButton;
            SelectedDifficulty = (CaroGameForm.GameDifficulty)clickedButton.Tag;
        }

        private void BtnOK_Click(object sender, EventArgs e)
        {
            if (isComputerMode)
            {
                // Ki?m tra ?ã ch?n ?? khó ch?a
                if (selectedButton == null)
                {
                    MessageBox.Show("Please select a difficulty level.", "Selection Required",
                        MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    this.DialogResult = DialogResult.None;
                    return;
                }
            }

            MaxGames = (int)numMaxGames.Value;
        }
    }
}